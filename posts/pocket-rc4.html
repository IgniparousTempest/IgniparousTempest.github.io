<!DOCTYPE HTML>
<!--
	Arcana by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Pocket-RC4 - Courtney Pitcher</title>
		<meta property="og:image" content="/images/playing_cards_in_hand.jpg"/>  
		<meta property="og:title" content="Pocket-RC4 - Courtney Pitcher"/>  
		<meta property="og:description" content="A cipher using a deck of standard playing cards."/> 
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<script src="/assets/google-analytics/google-analytics.js"></script>
		
		<script src="/assets/jquery-3.1.1.min.js"></script>
		
		<link href="/assets/prism/prism.css" rel="stylesheet" />
		<script src="/assets/prism/prism.js"></script>
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header">

					<!-- Logo -->
						<h1><a href="/" id="logo">Courtney <em>Pitcher</em></a></h1>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="/">Home</a></li>
								<li><a href="/index.html#software">Tech Posts</a></li>
								<li><a href="/posts/ciphers.html">Ciphers</a></li>
								<li class="current"><a href="#">Pocket-RC4</a></li>
							</ul>
						</nav>

				</div>

			<!-- Main -->
				<section class="wrapper style1">
					<div class="container">
						<div id="content">

							<!-- Content -->

								<article>
									<header>
										<h2>Pocket-RC4</h2>
										<p>Encryption for the covert magician.</p>
									</header>

									<p>Pocket-RC4 is an adaptation of the RC4B algorithm for use with standard playing cards, 
									developed by Matthew E. McKague in his <a href="https://uwspace.uwaterloo.ca/bitstream/handle/10012/1141/memckagu2005.pdf">master's thesis</a>.</p>
									
									<p>A card cipher is a great introduction to cryptography as it gives you something tangible 
									to work with, which helps to bind abstract cryptography concepts to real world objects; I highly 
									recommend this as a teaching aide for cryptography 101 courses.</p>
									
									<p>Let's assume you work for the Malevolent Association of Genuinely Ingenious Conjures 
									(M.A.G.I.C.), a clandestine order of magicians who need to covertly communicate the details of 
									their latest magic tricks.  Or you might be someone who wants to secretly communicate with 
									a friend, or you might just be someone who is interested in ciphers, but is far more fun to 
									assume you work for M.A.G.I.C..</p>
									
									<p>For the tl;dr version try jumping right ahead to the <a href="#code_example">code and 
									interactive demo</a>.</p>

									<h3>Setup</h3>
									<p>Before you begin, M.A.G.I.C. and you need to agree on the following things:</p>
									<ol style="list-style: decimal; margin-left: 20px;">
										<li>Initialisation Vector</li>
										<li>Key deck</li>
										<li>Card letter assignments</li>
									</ol>
									<p>These are all explained below.</p>

									<h4>1) Initialisation Vector</h4>
									<p>An initialisation vector (IV), is a string of random characters used to prepare the deck for 
									encryption/decryption. The IV adds additional randomness to the encryption process by ensuring 
									each ciphertext produced by the algorithm is associated with a pseudorandom initial deck state.
									This makes it harder for our nemesis to work out the key deck ordering from captured plaintext/ciphertext 
									pairs. This is why the IV should be unique for every communication and should be randomly generated. 
									An IV of 27 letters should be sufficient.</p>
									
									<p>An easy way to randomly generate an IV for a card cipher is to: shuffle the deck, draw a 
									card, write down the card's letter value, return the card to the deck. Repeat this until you have 
									an IV of 27 characters.</p>
									
									<h4>2) Key deck</h4>
									<p>The key deck is a specific ordering of cards in a deck. This ordering is kept secret and each 
									of the two parties wishing to communicate with each other will need to maintain the same ordering 
									as the other. When the IV and ciphertext are received, they are applied to the key deck to reveal 
									the hidden message.</p>
									
									<p>Any random deck order can be used as the key deck. A random order is better than a simple 
									pattern, as the simple pattern might be guessed easily in an intelligent brute force attack.</p>
									
									<p>The ciphertext and the IV are the public components of the encryption, they can be freely 
									captured without compromising the message (Sort of, RC4 is quite broken and each captured 
									IV/ciphertext pair gets you closer to revealing the key deck). The key deck's ordering is the secret 
									component of the communication, and should be changed if the ordering is ever compromised.</p>
									
									<h4>3) Card Values</h4>
									The assignment of letters to cards can be entirely decided upon by you, but assigning the cards 
									to letters in alphabetical order, with jokers being space, is the easiest, see below.
									
									<style>
									.flex-container {
									    display: -webkit-flex;
									    display: flex;
									    -webkit-flex-wrap: wrap;
									    flex-wrap: wrap;
									    width: 100%;
									    height: 100%;
									}

									.div_table {
									    text-align: center;
									    display:table;
									}
									.left_div_table {
									    border-collapse: separate;
									    -webkit-border-radius: 5px 0px 0px 5px;
									    -moz-border-radius: 5px 0px 0px 5px;
									    border-radius: 5px 0px 0px 5px;
									}
									.right_div_table {
									    border-collapse: separate;
									    -webkit-border-radius: 0px 5px 5px 0px;
									    -moz-border-radius: 0px 5px 5px 0px;
									    border-radius: 0px 5px 5px 0px;
									}
									.left_div_table, .right_div_table, .outer_div_table{
									    border: 1px solid black;
									    margin-bottom: 10px;
									    overflow: scroll;
									}
									.div_heading {
									    font-weight:bold;
									    width: 100%;
									    display: table-header-group;
									    border-bottom: 1px solid black;
									}
									.div_row {
									    display:table-row;
									    border: 1px solid black;
									}
									.cell {
									    display:table-cell;
									    width: 50%;
									    border: 1px solid black;
									    padding: 2px;
									    float: none;
									}
									.cell_heading {
									    width: 0%;
									    border-left: none;
									    border-right: none;
									    border-top: none;
									}
									.cell_middle {
									    border-left: none;
									    border-top: none;
									}
									.cell_middle_right {
									    border-left: none;
									    border-right: none;
									    border-top: none;
									}
									.cell_bottom {
									    border-left: none;
									    border-top: none;
									    border-bottom: none;
									}
									.cell_bottom_right {
									    border-left: none;
									    border-right: none;
									    border-top: none;
									    border-bottom: none;
									}
									.div_row:before, .div_row:after {
									    content: none;
									}
									</style>
									<div class="flex-container">
									   <div class='div_table left_div_table'>
									      <div class='div_heading'><div class='cell cell_heading'>Hearts and Spades</div></div>
									      <div class='div_table'>
										 <div class='div_heading'>
										    <div class='cell cell_middle'>Ace</div>
										    <div class='cell cell_middle'>2</div>
										    <div class='cell cell_middle'>3</div>
										    <div class='cell cell_middle'>4</div>
										    <div class='cell cell_middle'>5</div>
										    <div class='cell cell_middle'>6</div>
										    <div class='cell cell_middle'>7</div>
										    <div class='cell cell_middle'>8</div>
										    <div class='cell cell_middle'>9</div>
										    <div class='cell cell_middle'>10</div>
										    <div class='cell cell_middle'>Jack</div>
										    <div class='cell cell_middle'>Queen</div>
										    <div class='cell cell_middle_right'>King</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_middle'>1</div>
										    <div class='cell cell_middle'>2</div>
										    <div class='cell cell_middle'>3</div>
										    <div class='cell cell_middle'>4</div>
										    <div class='cell cell_middle'>5</div>
										    <div class='cell cell_middle'>6</div>
										    <div class='cell cell_middle'>7</div>
										    <div class='cell cell_middle'>8</div>
										    <div class='cell cell_middle'>9</div>
										    <div class='cell cell_middle'>10</div>
										    <div class='cell cell_middle'>11</div>
										    <div class='cell cell_middle'>12</div>
										    <div class='cell cell_middle_right'>13</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_bottom'>a</div>
										    <div class='cell cell_bottom'>b</div>
										    <div class='cell cell_bottom'>c</div>
										    <div class='cell cell_bottom'>d</div>
										    <div class='cell cell_bottom'>e</div>
										    <div class='cell cell_bottom'>f</div>
										    <div class='cell cell_bottom'>g</div>
										    <div class='cell cell_bottom'>h</div>
										    <div class='cell cell_bottom'>i</div>
										    <div class='cell cell_bottom'>j</div>
										    <div class='cell cell_bottom'>k</div>
										    <div class='cell cell_bottom'>l</div>
										    <div class='cell cell_bottom_right'>m</div>
										 </div>
									      </div>
									   </div>
									   <div class='div_table outer_div_table'>
									      <div class='div_heading'><div class='cell cell_heading'>Diamonds and Clubs</div></div>
									      <div class='div_table'>
										 <div class='div_heading'>
										    <div class='cell cell_middle'>Ace</div>
										    <div class='cell cell_middle'>2</div>
										    <div class='cell cell_middle'>3</div>
										    <div class='cell cell_middle'>4</div>
										    <div class='cell cell_middle'>5</div>
										    <div class='cell cell_middle'>6</div>
										    <div class='cell cell_middle'>7</div>
										    <div class='cell cell_middle'>8</div>
										    <div class='cell cell_middle'>9</div>
										    <div class='cell cell_middle'>10</div>
										    <div class='cell cell_middle'>Jack</div>
										    <div class='cell cell_middle'>Queen</div>
										    <div class='cell cell_middle_right'>King</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_middle'>14</div>
										    <div class='cell cell_middle'>15</div>
										    <div class='cell cell_middle'>16</div>
										    <div class='cell cell_middle'>17</div>
										    <div class='cell cell_middle'>18</div>
										    <div class='cell cell_middle'>19</div>
										    <div class='cell cell_middle'>20</div>
										    <div class='cell cell_middle'>21</div>
										    <div class='cell cell_middle'>22</div>
										    <div class='cell cell_middle'>23</div>
										    <div class='cell cell_middle'>24</div>
										    <div class='cell cell_middle'>25</div>
										    <div class='cell cell_middle_right'>26</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_bottom'>n</div>
										    <div class='cell cell_bottom'>o</div>
										    <div class='cell cell_bottom'>p</div>
										    <div class='cell cell_bottom'>q</div>
										    <div class='cell cell_bottom'>r</div>
										    <div class='cell cell_bottom'>s</div>
										    <div class='cell cell_bottom'>t</div>
										    <div class='cell cell_bottom'>u</div>
										    <div class='cell cell_bottom'>v</div>
										    <div class='cell cell_bottom'>w</div>
										    <div class='cell cell_bottom'>x</div>
										    <div class='cell cell_bottom'>y</div>
										    <div class='cell cell_bottom_right'>z</div>
										 </div>
									      </div>
									   </div>
									   <div class='div_table right_div_table'>
									      <div class='div_heading'><div class='cell cell_heading'>Joker</div></div>
									      <div class='div_table'>
										 <div class='div_heading'>
										    <div class='cell cell_middle_right'>Joker</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_middle_right'>27</div>
										 </div>
										 <div class='div_row'>
										    <div class='cell cell_bottom_right'>Space</div>
										 </div>
									      </div>
									   </div>
									</div>
									
									<h3>Algorithm</h3>
									<p>The Pocket-RC4 algorithm is a (nearly) symmetrical stream cipher. The only difference being: 
									When encrypting, you add the keystream value to the plaintext, and when decrypting, you subtract 
									the keystream value from the ciphertext.</p>
									
									<h4>Prepare the Key Deck</h4>
									<p>The key deck needs to be rearranged so that it maintains the same order within cards of 
									the same colour, but cards in the deck must alternate between colours, starting with red on top.</p>
									
									<ol style="list-style: decimal; margin-left: 20px;">
										<li>Take the key deck, face up.</li>
										<li>Deal each card from the key deck into either a red pile, or a black pile. Both piles must be face up and be sure to preserve the order exactly.</li>
										<li>Make a new pile, face up, by interleaving the two piles. This is done starting with the first black card, then the first red card, the second black card, second red, and so on. The new pile should have a red card on top and alternate between red and black cards.</li>
									</ol>
									
									<h4>Randomise the Key Deck with the Initialisation Vector (IV)</h4>
									<p>The pseudorandom initial deck ordering needs to be generated.</p>
									
									<ol style="list-style: decimal; margin-left: 20px;" start=4>
										<li>Take the key deck, face up.</li>
										<li>For each card in the IV sequence do the following:</li>
										<ol style="list-style: decimal; margin-left: 20px;">
											<li>Move the top red card to the bottom of the deck.</li>
											<li>Find the black card in the key deck that has the same value as the current IV card.</li>
											<li>Move the red card above this black card to the top of the deck.</li>
											<li>Move the black card to the bottom of the deck.</li>
											<li>Moce the top two cards (one red, one black) to the bottom of the deck.</li>
										</ol>
									</ol>
									
									<h4>Encrypt the Plaintext Message</h4>
									
									<ol style="list-style: decimal; margin-left: 20px;" start=6>
										<li>Take the key deck, face up.</li>
										<li>For each letter in the plaintext do the following:</li>
										<ol style="list-style: decimal; margin-left: 20px;">
											<li>Set j to the value of the bottom red card.</li>
											<li>Add the value of the top red card to j, modulo 27.</li>
											<li>Find the black card with the value of j.</li>
											<li>Set k to the value of the red card above the j black card plus the value of the top red card, modulo 27.</li>
											<li>Set k to the value of the plaintext letter plus k, modulo 27.</li>
											<li>Write down the corresponding ciphertext character, which has the value of k.</li>
											<li>Exchange the red card above the j black card with the top red card.</li>
											<li>Move the top black/red card pair to the bottom.</li>
										</ol>
									</ol>
									
									<h4>Decrypt the Ciphertext Message</h4>
									
									<ol style="list-style: decimal; margin-left: 20px;" start=6>
										<li>Take the key deck, face up.</li>
										<li>For each letter in the ciphertext do the following:</li>
										<ol style="list-style: decimal; margin-left: 20px;">
											<li>Set j to the value of the bottom red card.</li>
											<li>Add the value of the top red card to j, modulo 27.</li>
											<li>Find the black card with the value of j.</li>
											<li>Set k to the value of the red card above the j black card plus the value of the top red card, modulo 27.</li>
											<li>Set k to the value of the ciphertext letter minus k, modulo 27.</li>
											<li>Write down the corresponding plaintext character, which has the value of k.</li>
											<li>Exchange the red card above the j black card with the top red card.</li>
											<li>Move the top black/red card pair to the bottom.</li>
										</ol>
									</ol>
									
									<h3 id="code_example">Code Example</h3>
									<p>The following is a barebones example, and tries to do things as simply as possible; which 
									ignores a lot of good coding practices, as well as places where the implementation can be made 
									faster and/or more efficient.</p>
									
									<pre  class="line-numbers" data-src="/code/Pocket-RC4.py"></pre>
									
									<h3>Interactive Demo</h3>
									
									<script src="pocket_rc4.js"></script>
									
									<form>
										<div class="row 50%">
											<div class="6u 12u(mobilep)">
												<input type="text" name="key_deck" id="key_deck" placeholder="Face Up Keyed Deck" />
											</div>
											<div class="6u 12u(mobilep)">
												<input type="text" name="initialisation_vector" id="initialisation_vector" placeholder="Initialisation Vector" />
											</div>
										</div>
										<div class="row 50%">
											<div class="12u">
												<textarea name="plaintext" id="plaintext" placeholder="Plaintext Message" rows="5"></textarea>
											</div>
											<div class="12u">
												<textarea name="ciphertext" id="ciphertext" placeholder="Ciphertext" rows="5"></textarea>
											</div>
										</div>
										<div class="row 50%">
											<div>
												<ul class="actions">
													<li><input type="button" class="button alt" value="Encrypt Message" onclick="encrypt_on_click();"/></li>
													<li><input type="button" class="button alt" value="Decrypt Message" onclick="decrypt_on_click();"/></li>
												</ul>
											</div>
											<div style="float: right;">
												<ul class="actions">
													<li><input type="button" class="button" value="Load Example" onclick="load_example_on_click();"/></li>
												</ul>
											</div>
										</div>
									</form>
									
									<h3>Afterthoughs and Variations</h3>
									* The jokers can be excluded to produce a alphabet without spaces, a subtle variation on the algorithm would be required for this. This seems unnecessary, because the presense of jokers increases the cryptographic strength of the algorithm. You may want to remove the jokers if you are in a region or near a game that does not typically use jokers.<br>
									* The cards don't need to be assigned to the standard latin alphabet, you could swap them with characters from other writing systems. The space could be replaced with a ß, for German. A c could be repalced with an é for Afrikaans. In alphabets that contain less tahn 26 characters, the remaining cards can be used to duplicate letters, this will maintain cryptographic strength. If your alphabet contains more than 26 letters, you may build an encoding system that can store the alphabet in 26-space.
								</article>

						</div>
					</div>
				</section>

			<!-- Footer -->
				<script> 
					$(function(){
						$("#footer").load("/footer.html"); 
					});
				</script>
				<div id="footer"></div>

		</div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.dropotron.min.js"></script>
			<script src="/assets/js/skel.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="/assets/js/main.js"></script>

	</body>
</html>